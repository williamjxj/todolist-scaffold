# Implementation Plan: Switch persistent database from SQLite to PostgreSQL 17

**Branch**: `001-switch-db-postgresql` | **Date**: 2025-12-15 | **Spec**: `specs/001-switch-db-postgresql/spec.md`  
**Input**: Feature specification from `/specs/001-switch-db-postgresql/spec.md`

**Note**: This plan is generated by `/speckit.plan` for the local-dev PostgreSQL switch.

## Summary

Switch the FastAPI backend's persistent storage from SQLite to PostgreSQL 17 for local development, while keeping the public todo API unchanged. Provide configuration and migration steps so developers can point the app at a local PostgreSQL instance on a MacBook Pro, migrate any existing SQLite data, and continue using the app normally.

## Technical Context

**Language/Version**: Python 3.x (FastAPI backend), TypeScript/React frontend  
**Primary Dependencies**: FastAPI, SQLAlchemy (and associated database driver), React, Vite  
**Storage**: PostgreSQL 17 as primary local persistent store (with optional SQLite fallback)  
**Testing**: pytest for backend, vitest for frontend  
**Target Platform**: Local development on macOS (MacBook Pro)  
**Project Type**: Web application (separate `backend/` and `frontend/` apps)  
**Performance Goals**: Same perceived behavior as existing SQLite-backed app for local dev; no specific new throughput goals  
**Constraints**: Keep setup as simple as possible for local dev; avoid over-engineering (no complex zero-downtime schemes)  
**Scale/Scope**: Single-developer or small-team local development usage, modest todo data volume

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

Verify compliance with all four core principles:

### I. Code Quality
- [x] Linting and formatting tools configured (repo already has Python and JS tooling)
- [x] Type safety requirements defined (Type hints in Python, TypeScript on frontend)
- [x] Code review process established (via Git branches/PRs)
- [x] Complexity limits defined (keep new DB-related functions small and well-documented)

### II. Testing Standards
- [x] Testing framework selected and configured (pytest, vitest)
- [ ] Test coverage target defined (minimum 80% for new code)
- [x] Test categories identified (unit, integration, contract, E2E, performance)
- [ ] Test infrastructure setup planned (PostgreSQL-backed integration tests)

### III. User Experience Consistency
- [x] Design system/component library selected (React + existing UI components)
- [x] Styling approach defined (Tailwind-based frontend)
- [x] Accessibility standards defined (follow WCAG 2.1 AA in UI; no new UI for this feature)
- [x] UX consistency requirements identified (API behavior must remain unchanged)

### IV. Performance Requirements
- [ ] Performance budgets defined (SQLite→PostgreSQL switch should not noticeably degrade local UX)
- [ ] Performance monitoring strategy planned (basic logging around DB operations)
- [ ] Performance testing approach defined (sanity checks via integration tests)
- [ ] Core Web Vitals tracking planned (handled by existing frontend setup; not changed by this feature)

**Note**: Any remaining unchecked items will be addressed during implementation and testing planning; no blockers for this local-dev scoped feature.

## Project Structure

### Documentation (this feature)

```text
specs/001-switch-db-postgresql/
├── plan.md              # This file (/speckit.plan command output)
├── research.md          # Phase 0 output (decisions about Postgres, migration, config)
├── data-model.md        # Phase 1 output (Todo entity and DB config model)
├── quickstart.md        # Phase 1 output (how to run against Postgres locally)
├── contracts/           # Phase 1 output (OpenAPI contract, unchanged surface)
└── tasks.md             # Phase 2 output (/speckit.tasks command - NOT created here)
```

### Source Code (repository root)

```text
backend/
├── src/app/
│   ├── models.py        # SQLAlchemy models (Todo, etc.)
│   ├── database.py      # DB engine/session configuration (to be updated for Postgres)
│   ├── services/        # Business logic (todo_service)
│   ├── api/             # FastAPI routes (todos)
│   └── main.py          # App entrypoint
└── tests/               # Backend tests (unit + integration)

frontend/
├── src/
│   ├── components/      # React UI components
│   ├── hooks/           # `useTodos` hook
│   └── services/        # API client for todos
└── tests/               # Frontend tests (unchanged by DB switch)
```

**Structure Decision**: Use existing `backend/` and `frontend/` layout; only update backend database configuration, migration scripts, and documentation. No new top-level projects are introduced.

## Complexity Tracking

> **Fill ONLY if Constitution Check has violations that must be justified**

| Violation | Why Needed | Simpler Alternative Rejected Because |
|-----------|------------|-------------------------------------|
| None currently identified | N/A | N/A |
